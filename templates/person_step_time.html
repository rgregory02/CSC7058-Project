<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Step: Time</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 40px;
      text-align: center;
    }
    .box {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { margin-bottom: 20px; color: #333; }

    select, input[type="date"], input[type="range"] {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .add-entry-button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
    }

    ul { list-style-type: none; padding: 0; }
    li { padding: 5px 0; }

    .section-title {
      margin-top: 25px;
      font-weight: bold;
      font-size: 1.1em;
      color: #444;
    }

    .confidence-exact { color: green; font-weight: bold; }
    .confidence-high { color: green; }
    .confidence-medium { color: orange; }
    .confidence-low { color: red; }

    .icon { margin-right: 6px; }
  </style>
</head>
<body>
<div class="box">
  <h1>Step: Time</h1>
  <p><strong>Name:</strong> {{ name }}</p>
  <hr>

  <form method="POST">
    <label for="label_type">Choose a time type:</label>
    <select id="label_type" name="label_type" required onchange="window.location.href='?label_type=' + this.value">
      <option value="">-- Select Time Label --</option>
      {% for label, desc in label_files %}
        <option value="{{ label }}" {% if label == selected_label_type %}selected{% endif %}>
          {{ label|replace('_', ' ')|title }}{% if desc %} â€“ {{ desc }}{% endif %}
        </option>
      {% endfor %}
    </select>

    {% if selected_label_type == "date" %}
      <div>
        <label for="date_value">ðŸ“… Pick a date:</label>
        <input type="date" id="date_value" name="date_value" value="{{ selected_date or '' }}">
      </div>
    {% elif subfolder_labels %}
      <div>
        <label for="subvalue">ðŸ“š Select a value:</label>
        <select id="subvalue" name="subvalue">
          {% for item in subfolder_labels %}
            <option value="{{ item }}" {% if item == selected_subvalue %}selected{% endif %}>
              {{ item|replace('_', ' ')|title }}
            </option>
          {% endfor %}
        </select>
      </div>
    {% endif %}

    {% if selected_label_type %}
      <div style="margin-top:15px;">
        <label for="confidence">ðŸŽ¯ Confidence:</label>
        <input type="range" id="confidence" name="confidence" min="0" max="100"
               value="{{ selected_confidence or 100 }}" oninput="updateConfidenceDisplay()">
        <div>
          <span id="confidence_display">{{ selected_confidence or 100 }}</span>%
        </div>
        <div><small id="confidence_level" class=""></small></div>
      </div>

      <!-- âœ… Final Save & Continue Button -->
      <button type="submit" class="add-entry-button">âœ… Save Time Selection</button>
    {% endif %}
  </form>

  <hr>

  {% if existing_entries %}
    <div class="section-title">Current Time Period</div>
    <ul>
      {% set last = existing_entries[-1] %}
      <li>
        <span class="icon">ðŸ•’</span>{{ last[0]|replace('_', ' ')|title }} â€“ Confidence:
        <span class="{% if last[1]|int == 100 %}confidence-exact{% elif last[1]|int >= 67 %}confidence-high{% elif last[1]|int >= 34 %}confidence-medium{% else %}confidence-low{% endif %}">
          {{ last[1] }}{% if last[1]|int == 100 %} (Exact){% endif %}
        </span>
      </li>
    </ul>

    {% if existing_entries|length > 1 %}
      <div class="section-title">Previous Time Periods</div>
      <ul>
        {% for tag, conf in existing_entries[:-1] %}
          <li>
            <span class="icon">ðŸ“œ</span>{{ tag|replace('_', ' ')|title }} â€“ Confidence:
            <span class="{% if conf|int == 100 %}confidence-exact{% elif conf|int >= 67 %}confidence-high{% elif conf|int >= 34 %}confidence-medium{% else %}confidence-low{% endif %}">
              {{ conf }}{% if conf|int == 100 %} (Exact){% endif %}
            </span>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% else %}
    <p><em>No time period selected yet.</em></p>
  {% endif %}
</div>

<script>
  function updateConfidenceDisplay() {
    const slider = document.getElementById("confidence");
    const value = parseInt(slider.value || 0);
    document.getElementById("confidence_display").textContent = value + "%";

    const level = document.getElementById("confidence_level");
    if (value === 100) {
      level.textContent = "Confidence level: Exact";
      level.style.color = "green";
    } else if (value >= 67) {
      level.textContent = "Confidence level: High";
      level.style.color = "green";
    } else if (value >= 34) {
      level.textContent = "Confidence level: Medium";
      level.style.color = "orange";
    } else {
      level.textContent = "Confidence level: Low";
      level.style.color = "red";
    }
  }

  document.addEventListener("DOMContentLoaded", updateConfidenceDisplay);
</script>
</body>
</html>
<