
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>
    {% if mode == 'rename' %}
      {{ bio.name }} â€” Start
    {% else %}
      Start General Wizard
    {% endif %}
  </title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    .box{max-width:820px;margin:40px auto}
    .row{margin:12px 0}
    .label{font-weight:600;display:block;margin-bottom:6px}
    select,input[type="text"]{width:100%;max-width:480px}
  </style>
</head>
<body>
  <div class="box">
    {% if mode == 'rename' %}
      <h2>ðŸ“„ {{ bio.name }}</h2>
      <p><small>Type: {{ type_name }} â€¢ ID: {{ bio_id }}</small></p>

      <form method="POST">
        <label class="label">Rename (optional)</label>
        <input type="text" name="new_name" value="{{ bio.name }}">
        <div class="row">
          <button class="btn" type="submit">Continue to Time</button>
          <a class="btn secondary" href="{{ url_for('general_iframe_wizard', type=type_name, bio_id=bio_id, step='time') }}">Skip</a>
        </div>
      </form>

    {% else %}
      <h1>ðŸ§© Start General Wizard</h1>
      <form method="POST">
        <div class="row">
          <label class="label">Type</label>
          <select id="typeSelect" name="type_name" required>
            <option value="" disabled selected>Pick a typeâ€¦</option>
            {% for t in types %}
              <option value="{{ t }}" {{ 'selected' if request.args.get('type')==t else '' }}>
                {{ t|replace('_',' ')|title }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="row">
          <label class="label">Choose existing biography (optional)</label>
          <select id="bioSelect" name="bio_id">
            <option value="">â€” none â€”</option>
            {% for t, bios in per_type_bios.items() %}
              <optgroup label="{{ t|replace('_',' ')|title }}" data-type="{{ t }}">
                {% for b in bios %}
                  <option value="{{ b.id }}">[{{ t }}] {{ b.name }}</option>
                {% endfor %}
              </optgroup>
            {% endfor %}
          </select>
        </div>

        <div class="row">
          <label class="label">â€¦or create new biography</label>
          <input type="text" name="new_bio_name" placeholder="e.g., Royal Victoria Hospital">
        </div>

        <div class="row">
          <button type="submit" class="btn">Continue</button>
          <a class="btn secondary" href="{{ url_for('dashboard') }}">Cancel</a>
        </div>
      </form>

      <script>
        (function () {
          const typeSel = document.getElementById('typeSelect');
          const bioSel  = document.getElementById('bioSelect');
          const groups  = Array.from(bioSel.querySelectorAll('optgroup'));

          function filterGroups() {
            const t = typeSel.value;
            bioSel.value = "";
            groups.forEach(g => g.style.display = (t && g.dataset.type === t) ? '' : 'none');
          }
          groups.forEach(g => g.style.display = 'none');
          typeSel.addEventListener('change', filterGroups);
          // auto-filter if type was preselected via querystring
          if (typeSel.value) filterGroups();
        })();
      </script>
    {% endif %}
  </div>
</body>
</html>
