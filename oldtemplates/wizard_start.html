<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Start General Wizard</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="box">
    <h1>ðŸ§© Start General Wizard</h1>

    <form method="POST">
      <label>Type</label>
<select id="typeSelect" name="type_name" required>
  <option value="" disabled selected>Pick a typeâ€¦</option>
  {% for t in types %}
    <option value="{{ t }}">{{ t|replace('_',' ')|title }}</option>
  {% endfor %}
</select>

<div style="margin-top:12px">
  <label>Choose existing biography (optional)</label><br>
  <select id="bioSelect" name="bio_id">
    <option value="">â€” none â€”</option>
    {% for t, bios in per_type_bios.items() %}
      <optgroup label="{{ t|replace('_',' ')|title }}" data-type="{{ t }}">
        {% for b in bios %}
          <option value="{{ b.id }}">[{{ t }}] {{ b.name }}</option>
        {% endfor %}
      </optgroup>
    {% endfor %}
  </select>
</div>

      <div style="margin-top:12px">
        <label>â€¦or create new biography</label><br>
        <input type="text" name="new_bio_name" placeholder="e.g., Royal Victoria Hospital">
      </div>

      <div style="margin-top:16px">
        <button type="submit" class="btn">Continue</button>
        <a class="btn secondary" href="{{ url_for('dashboard') }}">Cancel</a>
      </div>
    </form>
  </div>
</body>
</html>

<script>
  (function () {
    const typeSel = document.getElementById('typeSelect');
    const bioSel  = document.getElementById('bioSelect');
    const groups  = Array.from(bioSel.querySelectorAll('optgroup'));

    function filterGroups() {
      const t = typeSel.value;
      // reset selection when type changes
      bioSel.value = "";
      groups.forEach(g => {
        g.style.display = (t && g.dataset.type === t) ? '' : 'none';
      });
    }

    // initial state (hide all until a type is chosen)
    groups.forEach(g => g.style.display = 'none');
    typeSel.addEventListener('change', filterGroups);
  })();
</script>